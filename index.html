<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turn Undead Simulator</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- Icons Components (Inline SVGs) ---
        const LineChart = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
        );
        const Activity = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        );
        const Calculator = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
        );
        const ShieldAlert = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
        );
        const Crosshair = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="22" x2="18" y1="12" y2="12"/><line x1="6" x2="2" y1="12" y2="12"/><line x1="12" x2="12" y1="6" y2="2"/><line x1="12" x2="12" y1="22" y2="18"/></svg>
        );

        // --- Main Component ---
        const TurnUndeadCalculator = () => {
            const [baseLv, setBaseLv] = useState(99);
            const [intStat, setIntStat] = useState(70);
            const [lukStat, setLukStat] = useState(30);
            const [skillLv, setSkillLv] = useState(10);
            const [hoverData, setHoverData] = useState(null);

            // Formula: (SkillLv * 20 + INT + LUK + BaseLv + (1 - HP/MaxHP) * 200) / 10
            // Capped at 70%
            const calculateChance = (currentHpPercent) => {
                const hpRatio = currentHpPercent / 100;
                const hpFactor = (1 - hpRatio) * 200;
                
                const baseFactor = (skillLv * 20) + intStat + lukStat + baseLv;
                
                const totalScore = baseFactor + hpFactor;
                const rawChance = totalScore / 10;
                
                return Math.min(70, Math.max(0, rawChance));
            };

            const dataPoints = useMemo(() => {
                const points = [];
                for (let hp = 0; hp <= 100; hp += 2) { 
                    points.push({
                        hp: hp,
                        chance: calculateChance(hp)
                    });
                }
                return points;
            }, [baseLv, intStat, lukStat, skillLv]);

            const width = 600;
            const height = 300;
            const padding = 70; // Increased padding to prevent label overlap
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            // X Scale: 100% on Left, 0% on Right
            const xScale = (hp) => padding + ((100 - hp) / 100) * chartWidth;
            const yScale = (chance) => height - padding - (chance / 100) * chartHeight;

            const pathData = dataPoints.map((point, index) => {
                const x = xScale(point.hp);
                const y = yScale(point.chance);
                return `${index === 0 ? 'M' : 'L'} ${x} ${y}`;
            }).join(' ');

            const handleMouseMove = (e) => {
                const svgRect = e.currentTarget.getBoundingClientRect();
                const mouseX = e.clientX - svgRect.left;
                
                // Scale mouse position from screen to SVG viewBox coordinates
                const scaledMouseX = (mouseX / svgRect.width) * width;
                
                let ratio = (scaledMouseX - padding) / chartWidth;
                ratio = Math.max(0, Math.min(1, ratio));
                
                const hp = 100 - (ratio * 100);
                const chance = calculateChance(hp);
                
                setHoverData({
                    x: xScale(hp),
                    y: yScale(chance),
                    hp: hp,
                    chance: chance
                });
            };

            const handleMouseLeave = () => {
                setHoverData(null);
            };

            return (
                <div className="flex flex-col items-center justify-center p-6 min-h-screen font-sans">
                    <div className="max-w-4xl w-full bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-r from-indigo-600 to-violet-600 p-6 text-white">
                            <div className="flex items-center gap-3 mb-2">
                                <Activity className="w-8 h-8 text-indigo-100" />
                                <h1 className="text-2xl font-bold tracking-tight">Turn Undead Simulator</h1>
                            </div>
                            <p className="opacity-90 text-sm font-light">
                                Simulates success chance based on formula: (SkillLv×20 + INT + LUK + BaseLv + (1 - HP%)×200) / 10
                            </p>
                        </div>

                        <div className="p-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
                            
                            {/* Controls Panel */}
                            <div className="lg:col-span-1 space-y-6 bg-slate-50 p-5 rounded-xl border border-slate-200 shadow-sm">
                                <h2 className="text-lg font-bold text-slate-700 flex items-center gap-2 pb-2 border-b border-slate-200">
                                    <Calculator className="w-5 h-5 text-indigo-500" />
                                    Character Stats
                                </h2>

                                {/* Base Lv */}
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <label className="text-sm font-semibold text-slate-600">Base Level</label>
                                        <span className="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">{baseLv}</span>
                                    </div>
                                    <input
                                        type="range" min="1" max="175" value={baseLv}
                                        onChange={(e) => setBaseLv(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-indigo-600"
                                    />
                                </div>

                                {/* INT */}
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <label className="text-sm font-semibold text-slate-600">INT (Total)</label>
                                        <span className="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">{intStat}</span>
                                    </div>
                                    <input
                                        type="range" min="1" max="200" value={intStat}
                                        onChange={(e) => setIntStat(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-indigo-600"
                                    />
                                </div>

                                {/* LUK */}
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <label className="text-sm font-semibold text-slate-600">LUK (Total)</label>
                                        <span className="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">{lukStat}</span>
                                    </div>
                                    <input
                                        type="range" min="1" max="200" value={lukStat}
                                        onChange={(e) => setLukStat(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-indigo-600"
                                    />
                                </div>

                                {/* Skill Level */}
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <label className="text-sm font-semibold text-slate-600">Skill Level</label>
                                        <span className="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs font-bold">{skillLv}</span>
                                    </div>
                                    <input
                                        type="range" min="1" max="10" value={skillLv}
                                        onChange={(e) => setSkillLv(Number(e.target.value))}
                                        className="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-indigo-600"
                                    />
                                </div>

                                {/* Tips section removed */}
                            </div>

                            {/* Graph Panel */}
                            <div className="lg:col-span-2 flex flex-col items-center">
                                <h2 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2 self-start">
                                    <LineChart className="w-5 h-5 text-indigo-500" />
                                    Probability Curve
                                </h2>
                                
                                <div className="relative w-full bg-white rounded-xl border border-slate-100 shadow-lg p-2 overflow-hidden hover:shadow-xl transition-shadow duration-300">
                                    <svg 
                                        viewBox={`0 0 ${width} ${height}`} 
                                        className="w-full h-auto cursor-crosshair"
                                        onMouseMove={handleMouseMove}
                                        onMouseLeave={handleMouseLeave}
                                    >
                                        {/* Horizontal Lines (Y-Axis) */}
                                        {[0, 25, 50, 70, 100].map((tick) => (
                                            <g key={`y-${tick}`}>
                                                <line
                                                    x1={padding} y1={yScale(tick)}
                                                    x2={width - padding} y2={yScale(tick)}
                                                    stroke={tick === 70 ? "#ef4444" : "#cbd5e1"} 
                                                    strokeWidth={tick === 70 ? 1.5 : 1}
                                                    strokeDasharray={tick === 70 ? "6,4" : ""}
                                                    opacity={tick === 0 ? 1 : 0.8}
                                                />
                                                <text
                                                    x={padding - 12} y={yScale(tick) + 4}
                                                    textAnchor="end"
                                                    className={`text-sm font-medium ${tick === 70 ? "fill-red-500 font-bold" : "fill-slate-500"}`}
                                                >
                                                    {tick}%
                                                </text>
                                            </g>
                                        ))}

                                        {/* Vertical Lines (X-Axis) */}
                                        {[0, 20, 40, 60, 80, 100].map((tick) => (
                                            <g key={`x-${tick}`}>
                                                <line
                                                    x1={xScale(tick)} y1={height - padding}
                                                    x2={xScale(tick)} y2={padding}
                                                    stroke="#e2e8f0" strokeWidth="1"
                                                />
                                                <text
                                                    x={xScale(tick)} y={height - padding + 24}
                                                    textAnchor="middle"
                                                    className="fill-slate-500 text-sm font-medium"
                                                >
                                                    {tick}%
                                                </text>
                                            </g>
                                        ))}

                                        {/* Line (No Glow, No Fill Area) */}
                                        <path
                                            d={pathData}
                                            fill="none"
                                            stroke="#4f46e5"
                                            strokeWidth="3"
                                            strokeLinecap="round"
                                            strokeLinejoin="round"
                                        />

                                        {/* Cap Label */}
                                        <rect 
                                            x={width - padding - 110} y={yScale(70) - 26} 
                                            width="110" height="22" rx="4" fill="white" opacity="0.9" 
                                            stroke="#ef4444" strokeWidth="0.5" strokeOpacity="0.3"
                                        />
                                        <text x={width - padding - 5} y={yScale(70) - 10} textAnchor="end" className="fill-red-500 text-xs font-bold tracking-wide">
                                            MAX CAP (70%)
                                        </text>

                                        {/* Y-Axis Label: Success Rate - Adjusted position */}
                                        <text 
                                            transform={`rotate(-90)`} 
                                            x={-height / 2} 
                                            y={20} 
                                            textAnchor="middle" 
                                            className="fill-slate-500 text-xs font-bold uppercase tracking-widest opacity-70"
                                        >
                                            Success Rate
                                        </text>

                                        {/* Tooltip with Target HP */}
                                        {hoverData && (
                                            <g>
                                                <line
                                                    x1={hoverData.x} y1={padding}
                                                    x2={hoverData.x} y2={height - padding}
                                                    stroke="#6366f1" strokeWidth="1" strokeDasharray="4,2"
                                                />
                                                <circle
                                                    cx={hoverData.x} cy={hoverData.y} r="6"
                                                    fill="#fff" stroke="#4f46e5" strokeWidth="3"
                                                />
                                                <g transform={`translate(${
                                                    Math.min(width - padding - 150, Math.max(padding + 10, hoverData.x - 75))
                                                }, ${Math.max(padding, hoverData.y - 85)})`}>
                                                    <rect
                                                        width="150" height="70" rx="8"
                                                        fill="#1e293b" fillOpacity="0.95"
                                                        style={{filter: "drop-shadow(0px 4px 6px rgba(0,0,0,0.1))"}}
                                                    />
                                                    
                                                    {/* HP Line */}
                                                    <text x="75" y="25" textAnchor="middle" fill="#cbd5e1" className="text-xs font-medium">
                                                        Target HP: <tspan fill="white" fontWeight="bold">{hoverData.hp.toFixed(0)}%</tspan>
                                                    </text>
                                                    
                                                    {/* Divider */}
                                                    <line x1="20" y1="35" x2="130" y2="35" stroke="#334155" strokeWidth="1" />

                                                    {/* Chance Line */}
                                                    <text x="75" y="55" textAnchor="middle" fill="#cbd5e1" className="text-xs font-medium">
                                                        Success: <tspan fill="#818cf8" fontWeight="bold" fontSize="16">{hoverData.chance.toFixed(2)}%</tspan>
                                                    </text>
                                                </g>
                                            </g>
                                        )}

                                        <text x={width/2} y={height - 10} textAnchor="middle" className="fill-slate-500 text-xs font-bold uppercase tracking-widest opacity-70">
                                            Target HP Remaining
                                        </text>
                                        
                                        <rect 
                                            x={padding} y={padding} 
                                            width={chartWidth} height={chartHeight} 
                                            fill="transparent" 
                                        />
                                    </svg>
                                </div>

                                {/* Stats Display */}
                                <div className="mt-6 grid grid-cols-2 gap-4 w-full">
                                    <div className="bg-emerald-50 p-4 rounded-xl border border-emerald-100 flex items-start gap-3 shadow-sm hover:shadow-md transition-shadow">
                                        <div className="p-2 bg-emerald-100 rounded-lg">
                                            <Crosshair className="w-5 h-5 text-emerald-600" />
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold text-emerald-800 uppercase tracking-wide">HP Full (100%)</h3>
                                            <p className="text-2xl font-black text-emerald-600">
                                                {calculateChance(100).toFixed(1)}%
                                            </p>
                                            <p className="text-xs text-emerald-700 mt-1 font-medium">
                                                Chance at start of battle
                                            </p>
                                        </div>
                                    </div>

                                    <div className="bg-amber-50 p-4 rounded-xl border border-amber-100 flex items-start gap-3 shadow-sm hover:shadow-md transition-shadow">
                                        <div className="p-2 bg-amber-100 rounded-lg">
                                            <ShieldAlert className="w-5 h-5 text-amber-600" />
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold text-amber-800 uppercase tracking-wide">Maximum Success Rate</h3>
                                            <div className="text-sm text-amber-900 mt-1 font-medium">
                                                {(() => {
                                                    const baseFactor = (skillLv * 20) + intStat + lukStat + baseLv;
                                                    const requiredHpRatio = (baseFactor - 500) / 200;
                                                    
                                                    if (requiredHpRatio >= 1) return <span className="text-emerald-600 font-bold">Max Rate: 70% at 100% HP</span>;
                                                    if (requiredHpRatio <= 0) return <span className="text-emerge-600 font-bold">Max Rate: 70% at {(requiredHpRatio * 100).toFixed(0)}% HP</span>;
                                                    
                                                    return <span>Max Rate: <strong className="text-lg">70%</strong> at <strong className="text-amber-700">{(requiredHpRatio * 100).toFixed(0)}% HP</strong></span>;
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TurnUndeadCalculator />);
    </script>
</body>
</html>